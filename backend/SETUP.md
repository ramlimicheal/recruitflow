# RecruitFlow Backend Setup Guide\n\n## Phase 1 Completion Summary\n\nBackend infrastructure for RecruitFlow is now ready. Here's what has been built:\n\n### ✅ Completed\n\n1. **Express.js Server** (`server.js`)\n   - RESTful API with CORS support\n   - Socket.io integration for real-time communication\n   - Health check endpoint\n   - Real-time event handlers for chat, notifications, activities\n\n2. **PostgreSQL Database Schema** (`config/database.js`)\n   - 11 tables with proper relationships and indexes\n   - Tables: Users, Candidates, Clients, Tasks, Interviews, ChatChannels, ChatMessages, Activities, Notifications, AutomationRules, StageHistory\n   - Automatic table creation on server start\n\n3. **Authentication System** (`middleware/auth.js`, `routes/auth.js`)\n   - JWT-based authentication\n   - Bcrypt password hashing\n   - Role-based access control (CEO, Manager, Recruiter)\n   - Login, Register, Get Current User endpoints\n\n4. **API Routes**\n   - `/api/auth` - Authentication (login, register, get user)\n   - `/api/candidates` - Candidate CRUD + stage management + activity logging\n   - `/api/tasks` - Task management\n   - `/api/chat` - Chat channels and messages\n   - `/api/notifications` - Notification management\n   - `/api/activities` - Activity feed and audit logs\n   - `/api/users` - User management\n\n5. **Real-Time Events**\n   - Chat messages with broadcasting\n   - Notifications with user targeting\n   - Activity logging\n   - Stage change updates\n\n## Prerequisites\n\n- Node.js (v14+)\n- PostgreSQL (v12+)\n- npm or yarn\n\n## Installation Steps\n\n### 1. Install Dependencies\n```bash\ncd backend\nnpm install\n```\n\n### 2. Set Up PostgreSQL Database\n\n#### On MacOS with Homebrew:\n```bash\n# Install PostgreSQL\nbrew install postgresql\n\n# Start PostgreSQL service\nbrew services start postgresql\n\n# Create database\ncreatedb recruitflow\n```\n\n#### On Windows/Linux:\nFollow your OS-specific PostgreSQL installation guide.\n\n### 3. Configure Environment Variables\n\nEdit `.env` file:\n```bash\n# Default settings (modify as needed)\nPORT=5000\nFRONTEND_URL=http://localhost:5173\n\n# Database\nDB_HOST=localhost\nDB_PORT=5432\nDB_NAME=recruitflow\nDB_USER=postgres\nDB_PASSWORD=password  # Change this!\n\n# JWT\nJWT_SECRET=your_super_secret_jwt_key_change_in_production\nJWT_EXPIRE=7d\n\n# Gemini API (for AI features)\nGEMINI_API_KEY=your_gemini_api_key_here\n\n# Email (optional, for later)\nSENDGRID_API_KEY=your_sendgrid_key_here\n\n# Razorpay (for Indian payments, optional)\nRAZORPAY_KEY_ID=your_razorpay_key_id\nRAZORPAY_KEY_SECRET=your_razorpay_key_secret\n```\n\n### 4. Start Backend Server\n\n#### Development mode (with auto-reload):\n```bash\nnpm install -g nodemon  # Install globally\nnpm run dev\n```\n\n#### Production mode:\n```bash\nnpm start\n```\n\nServer will start on `http://localhost:5000`\n\n### 5. Verify Setup\n\nTest health endpoint:\n```bash\ncurl http://localhost:5000/api/health\n```\n\nExpected response:\n```json\n{\"status\":\"Backend is running\",\"timestamp\":\"2025-12-03T16:00:00.000Z\"}\n```\n\n## API Testing\n\n### Using cURL or Postman\n\n#### 1. Register a User\n```bash\ncurl -X POST http://localhost:5000/api/auth/register \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"email\": \"ceo@recruitflow.com\",\n    \"name\": \"CEO Name\",\n    \"password\": \"password123\",\n    \"role\": \"CEO\"\n  }'\n```\n\n#### 2. Login\n```bash\ncurl -X POST http://localhost:5000/api/auth/login \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"email\": \"ceo@recruitflow.com\",\n    \"password\": \"password123\"\n  }'\n```\n\nSave the returned `token` for authenticated requests.\n\n#### 3. Create Candidate\n```bash\ncurl -X POST http://localhost:5000/api/candidates \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Authorization: Bearer YOUR_TOKEN_HERE\" \\\n  -d '{\n    \"name\": \"Arjun Mehta\",\n    \"email\": \"arjun@example.com\",\n    \"phone\": \"+91 98765 43210\",\n    \"role\": \"Senior React Developer\",\n    \"stage\": \"sourcing\",\n    \"expected_salary\": 4500000,\n    \"estimated_fee\": 375000,\n    \"probability\": 60\n  }'\n```\n\n## Next Steps\n\n### Phase 1.2 & 1.3 (Remaining)\n1. Create real-time sync for chat messages in Socket.io\n2. Create real-time sync for notifications\n3. Build frontend login/registration page\n4. Update React Context to connect to backend APIs\n\n### Phase 2: Chat & Collaboration\n1. Build Chat Panel component\n2. Implement @mention system\n3. Build Activity Feed\n4. Add comment sections\n\n### Phase 3: Automation & Notifications\n1. Build notification center UI\n2. Implement auto-task generation rules\n3. Set up background job scheduler\n4. Build Pending Actions widget\n\n## Troubleshooting\n\n### Database Connection Error\n```\nError: connect ECONNREFUSED 127.0.0.1:5432\n```\n**Solution**: Ensure PostgreSQL is running\n```bash\nbrew services start postgresql  # MacOS\n# Or start PostgreSQL service on your OS\n```\n\n### Port Already in Use\n```\nError: listen EADDRINUSE: address already in use :::5000\n```\n**Solution**: Change PORT in .env or kill the process using port 5000\n```bash\nlsof -i :5000  # Find process\nkill -9 <PID>  # Kill process\n```\n\n### JWT Token Errors\n```\nError: Invalid token\n```\n**Solution**: \n- Ensure Authorization header format: `Bearer YOUR_TOKEN`\n- Token may have expired (default 7 days)\n- Register a new user and login again\n\n## Database Tables Overview\n\n- **users**: Team members with roles\n- **candidates**: Job candidates in pipeline\n- **clients**: Client companies\n- **tasks**: Action items\n- **interviews**: Interview scheduling\n- **chat_channels**: Team chat channels\n- **chat_messages**: Chat messages\n- **activities**: Audit log of all actions\n- **notifications**: User notifications\n- **automation_rules**: Auto-task triggers\n- **stage_history**: Candidate stage changes\n\n## Architecture Diagram\n\n```\n┌─────────────────────────────────────┐\n│      Frontend (React)               │\n│  (localhost:5173)                   │\n└────────────┬────────────────────────┘\n             │ HTTP + WebSocket\n             ▼\n┌─────────────────────────────────────┐\n│   Backend (Node.js + Express)       │\n│   (localhost:5000)                  │\n│  ┌──────────────────────────────┐   │\n│  │ Socket.io (Real-time)        │   │\n│  │ - Chat                       │   │\n│  │ - Notifications              │   │\n│  │ - Activity Feed              │   │\n│  └──────────────────────────────┘   │\n└────────────┬────────────────────────┘\n             │ SQL\n             ▼\n┌─────────────────────────────────────┐\n│    PostgreSQL Database              │\n│    (localhost:5432)                 │\n│    Database: recruitflow            │\n└─────────────────────────────────────┘\n```\n\n## Performance Tips\n\n1. **Database Indexes**: Already added on frequently queried columns\n2. **Connection Pooling**: Using pg connection pool (default 10 connections)\n3. **Real-time Optimization**: Socket.io broadcasts only to relevant users\n4. **API Pagination**: Implement pagination for large datasets\n\n## Security Notes\n\n1. **JWT Secret**: Change `JWT_SECRET` in production\n2. **Password Hashing**: All passwords hashed with bcrypt (10 rounds)\n3. **Role-Based Access**: Implement role checks for sensitive operations\n4. **CORS**: Configure allowed origins in production\n5. **Environment Variables**: Never commit `.env` file\n\n## Development Commands\n\n```bash\n# Install dependencies\nnpm install\n\n# Start development server\nnpm run dev\n\n# Start production server\nnpm start\n\n# Test API health\ncurl http://localhost:5000/api/health\n```\n\n## Database Backup\n\n```bash\n# Backup database\npg_dump recruitflow > backup.sql\n\n# Restore database\npsql recruitflow < backup.sql\n```\n"